import{_ as V}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{d as L,c as v,o as u,b as S,l as $,r as d,e as T,h as o,w as t,j as s,bz as b,bA as h,c1 as A,a as r,bt as C,bs as D,c2 as E,i as l,br as N,F,k as I,g as j,bC as B,t as m,bX as G,by as H,c3 as U,bE as J}from"./index-C5I1O8sb.js";import{L as W}from"./LockClosedOutline-CBMIGomh.js";const X={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},q=L({name:"DiamondOutline",render:function(_,i){return u(),v("svg",X,i[0]||(i[0]=[S('<path d="M35.42 188.21l207.75 269.46a16.17 16.17 0 0 0 25.66 0l207.75-269.46a16.52 16.52 0 0 0 .95-18.75L407.06 55.71A16.22 16.22 0 0 0 393.27 48H118.73a16.22 16.22 0 0 0-13.79 7.71L34.47 169.46a16.52 16.52 0 0 0 .95 18.75z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M48 176h416"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M400 64l-48 112l-96-128"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M112 64l48 112l96-128"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M256 448l-96-272"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M256 448l96-272"></path>',6)]))}}),K={class:"page"},Q={class:"card-header"},R={class:"card-title"},Y={class:"price-box"},Z={style:{"font-size":"16px",margin:"0"}},ee={__name:"service",setup(M){const _=document.cookie.split("; ").find(a=>a.startsWith("user_token="))?.split("=")[1],i=a=>`${window.server.url}/php/user/index.php?action=${a}&token=${_}`,k=$(),c=d(0),y=d([]),p=d(!1),f=d(null),g=d(!1),x=async()=>{const{success:a,balance:e}=await fetch(i("getUserBalance")).then(n=>n.json());a&&(c.value=e)},z=async()=>{try{const{success:a,products:e,message:n}=await fetch(i("getPassProducts")).then(w=>w.json());if(a)y.value=e;else throw new Error(n||"获取商品失败")}catch(a){k.error(a.message||"获取商品失败")}},P=a=>{f.value=a,p.value=!0},O=async()=>{g.value=!0;const a=await fetch(i("buyPass"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pid:f.value.id})}).then(e=>e.json());g.value=!1,a.success?(k.success("购买成功！"),p.value=!1,x()):k.error(a.message||"购买失败")};return T(()=>{x(),z()}),(a,e)=>(u(),v("div",K,[o(s(N),{class:"top-card",hoverable:""},{default:t(()=>[o(s(b),{cols:"24","x-gap":"12","item-responsive":"",responsive:"screen"},{default:t(()=>[o(s(h),{span:"24 m:18"},{default:t(()=>[o(s(A),{style:{display:"flex","align-items":"center",margin:"0"}},{default:t(()=>[o(s(C),{size:"28",color:"#18a058"},{default:t(()=>[o(s(q))]),_:1}),e[1]||(e[1]=r("span",{style:{"margin-left":"8px"}},"通行密码 · 增值服务",-1))]),_:1,__:[1]})]),_:1}),o(s(h),{span:"24 m:6",style:{"text-align":"right"}},{default:t(()=>[o(s(D),{label:"账户余额","tabular-nums":""},{suffix:t(()=>e[2]||(e[2]=[l("元")])),default:t(()=>[o(s(E),{from:0,to:c.value,precision:2},null,8,["to"])]),_:1})]),_:1})]),_:1})]),_:1}),o(s(b),{cols:"1 s:2 m:3","x-gap":"18","y-gap":"18",responsive:"screen",style:{"margin-top":"24px"}},{default:t(()=>[(u(!0),v(F,null,I(y.value,n=>(u(),j(s(h),{key:n.id},{default:t(()=>[o(s(N),{hoverable:"",class:"product-card"},{header:t(()=>[r("div",Q,[o(s(C),{size:"18",color:"#2080f0"},{default:t(()=>[o(s(W))]),_:1}),r("span",R,m(n.name),1)])]),footer:t(()=>[o(s(H),{type:"primary",size:"large",block:"",strong:"",disabled:n.yuan>c.value,onClick:w=>P(n)},{icon:t(()=>[o(s(U))]),default:t(()=>[e[3]||(e[3]=l(" 立即购买 "))]),_:2,__:[3]},1032,["disabled","onClick"]),n.yuan>c.value?(u(),j(s(B),{key:0,depth:"3",style:{display:"block","text-align":"center","margin-top":"4px","font-size":"12px"}},{default:t(()=>e[4]||(e[4]=[l(" 余额不足 ")])),_:1,__:[4]})):G("",!0)]),default:t(()=>[r("div",Y,[o(s(B),{type:"success",class:"price"},{default:t(()=>[l("¥"+m(n.yuan.toFixed(2)),1)]),_:2},1024)])]),_:2},1024)]),_:2},1024))),128))]),_:1}),o(s(J),{show:p.value,"onUpdate:show":e[0]||(e[0]=n=>p.value=n),preset:"dialog",type:"success",title:"确认购买","positive-text":"确认","negative-text":"取消",loading:g.value,onPositiveClick:O},{default:t(()=>[r("p",Z,[e[5]||(e[5]=l(" 确定花费 ")),r("strong",null,"¥"+m(f.value?.yuan),1),e[6]||(e[6]=l(" 购买 ")),r("strong",null,"“"+m(f.value?.name)+"”",1),e[7]||(e[7]=l("？ "))])]),_:1},8,["show","loading"])]))}},ae=V(ee,[["__scopeId","data-v-9a2d60ac"]]);export{ae as default};
