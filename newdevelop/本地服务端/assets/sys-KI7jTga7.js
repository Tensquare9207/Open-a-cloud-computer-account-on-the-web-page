import{d as K,c as N,o as r,b as G,a,l as H,r as u,e as Q,f as R,h as l,g as v,bX as m,w as n,j as t,bY as I,i as w,bw as d,t as y,by as c,bt as U,bE as P,bx as Z,br as L,F as ee}from"./index-C5I1O8sb.js";const te={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ne=K({name:"EyeOffOutline",render:function(f,s){return r(),N("svg",te,s[0]||(s[0]=[G('<path d="M432 448a15.92 15.92 0 0 1-11.31-4.69l-352-352a16 16 0 0 1 22.62-22.62l352 352A16 16 0 0 1 432 448z" fill="currentColor"></path><path d="M255.66 384c-41.49 0-81.5-12.28-118.92-36.5c-34.07-22-64.74-53.51-88.7-91v-.08c19.94-28.57 41.78-52.73 65.24-72.21a2 2 0 0 0 .14-2.94L93.5 161.38a2 2 0 0 0-2.71-.12c-24.92 21-48.05 46.76-69.08 76.92a31.92 31.92 0 0 0-.64 35.54c26.41 41.33 60.4 76.14 98.28 100.65C162 402 207.9 416 255.66 416a239.13 239.13 0 0 0 75.8-12.58a2 2 0 0 0 .77-3.31l-21.58-21.58a4 4 0 0 0-3.83-1a204.8 204.8 0 0 1-51.16 6.47z" fill="currentColor"></path><path d="M490.84 238.6c-26.46-40.92-60.79-75.68-99.27-100.53C349 110.55 302 96 255.66 96a227.34 227.34 0 0 0-74.89 12.83a2 2 0 0 0-.75 3.31l21.55 21.55a4 4 0 0 0 3.88 1a192.82 192.82 0 0 1 50.21-6.69c40.69 0 80.58 12.43 118.55 37c34.71 22.4 65.74 53.88 89.76 91a.13.13 0 0 1 0 .16a310.72 310.72 0 0 1-64.12 72.73a2 2 0 0 0-.15 2.95l19.9 19.89a2 2 0 0 0 2.7.13a343.49 343.49 0 0 0 68.64-78.48a32.2 32.2 0 0 0-.1-34.78z" fill="currentColor"></path><path d="M256 160a95.88 95.88 0 0 0-21.37 2.4a2 2 0 0 0-1 3.38l112.59 112.56a2 2 0 0 0 3.38-1A96 96 0 0 0 256 160z" fill="currentColor"></path><path d="M165.78 233.66a2 2 0 0 0-3.38 1a96 96 0 0 0 115 115a2 2 0 0 0 1-3.38z" fill="currentColor"></path>',5)]))}}),ae={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},le=K({name:"EyeOutline",render:function(f,s){return r(),N("svg",ae,s[0]||(s[0]=[a("path",{d:"M255.66 112c-77.94 0-157.89 45.11-220.83 135.33a16 16 0 0 0-.27 17.77C82.92 340.8 161.8 400 255.66 400c92.84 0 173.34-59.38 221.79-135.25a16.14 16.14 0 0 0 0-17.47C428.89 172.28 347.8 112 255.66 112z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),a("circle",{cx:"256",cy:"256",r:"80",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1)]))}}),se={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},oe=K({name:"PencilOutline",render:function(f,s){return r(),N("svg",se,s[0]||(s[0]=[a("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M364.13 125.25L87 403l-23 45l44.99-23l277.76-277.13l-22.62-22.62z"},null,-1),a("path",{d:"M420.69 68.69l-22.62 22.62l22.62 22.63l22.62-22.63a16 16 0 0 0 0-22.62h0a16 16 0 0 0-22.62 0z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)]))}}),re={__name:"sys",setup(O){const f=H(),s=u(!1),k=u({}),b=u(""),j=u(!1),h=u(!1),_=u(""),S=u(!1),z=u(!1),D=u(null),C=u(!1),$=u("授权版"),M=u(!1),g=u(null),V=u(""),F=()=>j.value=!j.value,J=()=>{_.value=b.value,h.value=!0},x=()=>document.cookie.split("; ").find(o=>o.startsWith("admin_token="))?.split("=")[1],T=async()=>{S.value=!0;const o=x();if(!o){f.error("请先登录"),S.value=!1;return}try{const i=await(await fetch(`${window.server.url}/php/admin/index.php?action=getsys&token=${o}`)).json();i.success&&i.data?.success?(s.value=!0,k.value=i.data,await A(),f.success("拉取成功感谢您的支持！")):(s.value=!1,await A(),f.error(i.message||"未授权"))}catch{f.error("网络错误")}finally{S.value=!1}},W=async()=>{const o=x(),i=await(await fetch(`${window.server.url}/php/admin/index.php?action=getSettings2&token=${o}`)).json();if(i.success){const p=i.data.find(B=>B.name==="typex");$.value=p?.config||"授权版"}C.value=!0},X=async()=>{M.value=!0;const o=x();await fetch(`${window.server.url}/php/admin/index.php?action=setSetting2&token=${o}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"typex",config:$.value})}),f.success("系统类型已更新"),C.value=!1,M.value=!1},A=async()=>{const o=x(),i=await(await fetch(`${window.server.url}/php/admin/index.php?action=getSettings2&token=${o}`)).json();if(i.success){const p=i.data.find(E=>E.name==="key");b.value=p?.config||"";const B=i.data.find(E=>E.name==="version");V.value=B?.config||"未知"}},Y=async()=>{if(!_.value.trim()){f.warning("请输入授权码");return}z.value=!0;const o=x();await fetch(`${window.server.url}/php/admin/index.php?action=setSetting2&token=${o}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"key",config:_.value.trim()})}),f.success("已更新授权码"),b.value=_.value.trim(),h.value=!1,z.value=!1,await T()},q=async()=>{const o=x();if(o)try{const i=await(await fetch(`${window.server.url}/php/admin/index.php?action=getupdata&token=${o}`)).json();i.success&&(g.value=i.data)}catch{f.error("获取更新信息失败")}};return Q(async()=>{await T(),s.value&&await q()}),(o,e)=>{const i=R("n-select");return r(),N(ee,null,[l(t(L),{title:"蓝天新世界业务系统授权"},{default:n(()=>[a("img",{ref_key:"logo",ref:D,src:"https://hiltyun.com/1img/lt.png",alt:"logo",width:"120",draggable:"true",style:{}},null,512),s.value?m("",!0):(r(),v(t(I),{key:0,type:"error",style:{"margin-bottom":"16px"}},{default:n(()=>e[6]||(e[6]=[w(" 未授权，请前往 "),a("a",{href:"https://hiltyun.com/console/?gm",target:"_blank"},"购买授权",-1)])),_:1,__:[6]})),l(t(d),{vertical:""},{default:n(()=>[s.value?(r(),v(t(d),{key:0,justify:"space-between",align:"center"},{default:n(()=>[e[7]||(e[7]=a("span",{style:{"font-weight":"600"}},"项目名称",-1)),a("span",null,y(k.value.project),1)]),_:1,__:[7]})):m("",!0),s.value?(r(),v(t(d),{key:1,justify:"space-between",align:"center"},{default:n(()=>[e[8]||(e[8]=a("span",{style:{"font-weight":"600"}},"授权域名",-1)),a("span",null,y(k.value.link),1)]),_:1,__:[8]})):m("",!0),s.value?(r(),v(t(d),{key:2,justify:"space-between",align:"center"},{default:n(()=>[e[9]||(e[9]=a("span",{style:{"font-weight":"600"}},"授权用户",-1)),a("span",null,y(k.value.username),1)]),_:1,__:[9]})):m("",!0),s.value?(r(),v(t(d),{key:3,justify:"space-between",align:"center"},{default:n(()=>[e[10]||(e[10]=a("span",{style:{"font-weight":"600"}},"创建时间",-1)),a("span",null,y(k.value.created_at),1)]),_:1,__:[10]})):m("",!0),s.value?(r(),v(t(d),{key:4,justify:"space-between",align:"center"},{default:n(()=>[e[11]||(e[11]=a("span",{style:{"font-weight":"600"}},"到期时间",-1)),a("span",null,y(k.value.time),1)]),_:1,__:[11]})):m("",!0),l(t(d),{justify:"space-between",align:"center"},{default:n(()=>[e[12]||(e[12]=a("span",{style:{"font-weight":"600"}},"授权码",-1)),l(t(d),{align:"center","wrap-item":!1},{default:n(()=>[a("span",null,y(j.value?b.value:"••••••"),1),l(t(c),{text:"",onClick:F},{default:n(()=>[l(t(U),{size:"16"},{default:n(()=>[j.value?(r(),v(t(ne),{key:1})):(r(),v(t(le),{key:0}))]),_:1})]),_:1}),l(t(c),{text:"",onClick:J},{default:n(()=>[l(t(U),{size:"16"},{default:n(()=>[l(t(oe))]),_:1})]),_:1})]),_:1})]),_:1,__:[12]})]),_:1}),l(t(c),{type:"primary",style:{"margin-top":"16px"},loading:S.value,onClick:T},{default:n(()=>e[13]||(e[13]=[w(" 拉取授权 ")])),_:1,__:[13]},8,["loading"]),l(t(c),{type:"info",style:{"margin-top":"16px","margin-left":"12px"},onClick:W},{default:n(()=>e[14]||(e[14]=[w(" 更换系统 ")])),_:1,__:[14]}),l(t(P),{show:h.value,"onUpdate:show":e[2]||(e[2]=p=>h.value=p),preset:"dialog",title:"修改授权码"},{action:n(()=>[l(t(c),{onClick:e[1]||(e[1]=p=>h.value=!1)},{default:n(()=>e[15]||(e[15]=[w("取消")])),_:1,__:[15]}),l(t(c),{type:"primary",loading:z.value,onClick:Y},{default:n(()=>e[16]||(e[16]=[w("保存")])),_:1,__:[16]},8,["loading"])]),default:n(()=>[l(t(Z),{value:_.value,"onUpdate:value":e[0]||(e[0]=p=>_.value=p),placeholder:"请输入新的授权码"},null,8,["value"])]),_:1},8,["show"])]),_:1}),s.value&&g.value?(r(),v(t(L),{key:0,title:"系统更新",style:{"margin-top":"16px"}},{default:n(()=>[l(t(d),{vertical:""},{default:n(()=>[l(t(d),{justify:"space-between"},{default:n(()=>[e[17]||(e[17]=a("span",null,"当前版本",-1)),a("span",null,y(V.value),1)]),_:1,__:[17]}),l(t(d),{justify:"space-between"},{default:n(()=>[e[18]||(e[18]=a("span",null,"最新版本",-1)),a("span",null,y(g.value.version),1)]),_:1,__:[18]}),l(t(d),{justify:"space-between"},{default:n(()=>[e[19]||(e[19]=a("span",null,"更新日期",-1)),a("span",null,y(g.value.data),1)]),_:1,__:[19]}),l(t(d),{vertical:""},{default:n(()=>[e[20]||(e[20]=a("span",{style:{"font-weight":"600"}},"更新内容",-1)),a("span",null,y(g.value.updateDetails),1)]),_:1,__:[20]}),g.value.updateAvailable?(r(),v(t(c),{key:0,type:"primary",tag:"a",href:g.value.downloadLink,target:"_blank"},{default:n(()=>e[21]||(e[21]=[w(" 立即下载 ")])),_:1,__:[21]},8,["href"])):(r(),v(t(I),{key:1,type:"success"},{default:n(()=>e[22]||(e[22]=[w(" 当前已是最新版本 ")])),_:1,__:[22]}))]),_:1})]),_:1})):m("",!0),l(t(P),{show:C.value,"onUpdate:show":e[5]||(e[5]=p=>C.value=p),preset:"dialog",title:"更换系统类型"},{action:n(()=>[l(t(c),{onClick:e[4]||(e[4]=p=>C.value=!1)},{default:n(()=>e[23]||(e[23]=[w("取消")])),_:1,__:[23]}),l(t(c),{type:"primary",loading:M.value,onClick:X},{default:n(()=>e[24]||(e[24]=[w(" 确定 ")])),_:1,__:[24]},8,["loading"])]),default:n(()=>[l(i,{value:$.value,"onUpdate:value":e[3]||(e[3]=p=>$.value=p),options:[{label:"授权版",value:"授权版"},{label:"社区版",value:"社区版"}]},null,8,["value"])]),_:1},8,["show"])],64)}}};export{re as default};
