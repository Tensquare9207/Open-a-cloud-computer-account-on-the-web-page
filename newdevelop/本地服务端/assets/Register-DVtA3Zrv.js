import{u as I,r as v,l as Q,f as p,g as T,o as N,w as l,h as a,a as S,i as _,t as U}from"./index-C5I1O8sb.js";const j={style:{display:"flex",gap:"10px"}},V={__name:"Register",setup(O){const h=I(),t=v({username:"",password:"",email:"",qq:"",code:"",token:"",captchaId:""}),w={username:{required:!0,message:"请输入用户名",trigger:["blur","input"]},password:{required:!0,message:"请输入密码",trigger:["blur","input"]},email:[{required:!0,message:"请输入邮箱",trigger:["blur","input"]},{type:"email",message:"请输入正确的邮箱格式",trigger:["blur","input"]}],qq:{required:!0,message:"请输入QQ号",trigger:["blur","input"]},code:{required:!0,message:"请输入验证码",trigger:["blur","input"]}},n=Q(),o=v(!1),d=v(60);let f=null;const b=()=>{o.value=!0,d.value=60,f=setInterval(()=>{d.value-=1,d.value<=0&&(clearInterval(f),o.value=!1)},1e3)};let c=null,m=null;const g=u=>{u===1&&o.value||initCaptcha(u,(e,r)=>{c=e,m=r,u===1?q():C()},()=>{})},q=async()=>{try{const e=await(await fetch(window.server.url+"/php/send_verification.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.value.email,qq:t.value.qq,username:t.value.username,token:c,captchaId:m})})).json();e.status==="success"?(n.success("验证码已发送"),b()):n.error(e.message)}catch{n.error("请求失败")}},C=async()=>{try{const e=await(await fetch(window.server.url+"/php/zc.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t.value,token:c,captchaId:m})})).json();e.status==="success"?(n.success("注册成功"),h.push("/login")):n.error(e.message)}catch{n.error("注册失败")}};return(u,e)=>{const r=p("n-input"),i=p("n-form-item"),y=p("n-button"),k=p("n-form"),x=p("n-card");return N(),T(x,{title:"注册",style:{"max-width":"400px",margin:"0 auto"}},{default:l(()=>[a(k,{ref:"formRef",model:t.value,rules:w},{default:l(()=>[a(i,{label:"用户名",path:"username"},{default:l(()=>[a(r,{type:"username",value:t.value.username,"onUpdate:value":e[0]||(e[0]=s=>t.value.username=s),placeholder:"请输入账号"},null,8,["value"])]),_:1}),a(i,{label:"密码",path:"password"},{default:l(()=>[a(r,{type:"password",value:t.value.password,"onUpdate:value":e[1]||(e[1]=s=>t.value.password=s),placeholder:"请输入密码"},null,8,["value"])]),_:1}),a(i,{label:"邮箱",path:"email"},{default:l(()=>[a(r,{type:"email",value:t.value.email,"onUpdate:value":e[2]||(e[2]=s=>t.value.email=s),placeholder:"请输入邮箱"},null,8,["value"])]),_:1}),a(i,{label:"QQ",path:"qq"},{default:l(()=>[a(r,{type:"number",value:t.value.qq,"onUpdate:value":e[3]||(e[3]=s=>t.value.qq=s),placeholder:"请输入QQ号"},null,8,["value"])]),_:1}),a(i,{label:"验证码",path:"code"},{default:l(()=>[S("div",j,[a(r,{value:t.value.code,"onUpdate:value":e[4]||(e[4]=s=>t.value.code=s),placeholder:"请输入验证码"},null,8,["value"]),a(y,{onClick:e[5]||(e[5]=s=>g(1)),disabled:o.value,style:{width:"110px"}},{default:l(()=>[_(U(o.value?`${d.value}s`:"获取验证码"),1)]),_:1},8,["disabled"])])]),_:1}),a(y,{type:"primary",onClick:e[6]||(e[6]=s=>g(2)),block:""},{default:l(()=>e[7]||(e[7]=[_("立即注册")])),_:1,__:[7]})]),_:1},8,["model"])]),_:1})}}};export{V as default};
