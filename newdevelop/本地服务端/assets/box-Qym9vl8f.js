import{d as U,c as h,o as m,a as o,l as oe,bv as ae,r as x,aZ as ne,f as G,g as A,w as l,h as e,j as t,bw as I,by as w,i as d,bt as k,t as u,bz as ie,F as L,k as J,bA as de,br as b,bC as v,bI as C,bJ as ue,bK as ce,bL as N,bE as _e,bH as pe,bM as ve,bN as me,bO as E,bP as y,bu as R,b7 as W,bQ as fe}from"./index-C5I1O8sb.js";const ge={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},we=U({name:"ArrowDown",render:function(p,c){return m(),h("svg",ge,c[0]||(c[0]=[o("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 268l144 144l144-144"},null,-1),o("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M256 392V100"},null,-1)]))}}),ye={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},he=U({name:"ArrowUp",render:function(p,c){return m(),h("svg",ye,c[0]||(c[0]=[o("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 244l144-144l144 144"},null,-1),o("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M256 120v292"},null,-1)]))}}),ke={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},K=U({name:"Copy",render:function(p,c){return m(),h("svg",ke,c[0]||(c[0]=[o("path",{d:"M408 480H184a72 72 0 0 1-72-72V184a72 72 0 0 1 72-72h224a72 72 0 0 1 72 72v224a72 72 0 0 1-72 72z",fill:"currentColor"},null,-1),o("path",{d:"M160 80h235.88A72.12 72.12 0 0 0 328 32H104a72 72 0 0 0-72 72v224a72.12 72.12 0 0 0 48 67.88V160a80 80 0 0 1 80-80z",fill:"currentColor"},null,-1)]))}}),xe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Q=U({name:"Refresh",render:function(p,c){return m(),h("svg",xe,c[0]||(c[0]=[o("path",{d:"M320 146s24.36-12-64-12a160 160 0 1 0 160 160",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-miterlimit":"10","stroke-width":"32"},null,-1),o("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 58l80 80l-80 80"},null,-1)]))}}),be={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ce=U({name:"Server",render:function(p,c){return m(),h("svg",be,c[0]||(c[0]=[o("path",{d:"M256 428c-52.35 0-111.39-11.61-157.93-31c-17.07-7.19-31.69-18.82-43.64-28a4 4 0 0 0-6.43 3.18v12.58c0 28.07 23.49 53.22 66.14 70.82C152.29 471.33 202.67 480 256 480s103.7-8.67 141.86-24.42C440.51 438 464 412.83 464 384.76v-12.58a4 4 0 0 0-6.43-3.18c-11.95 9.17-26.57 20.81-43.65 28c-46.54 19.39-105.57 31-157.92 31z",fill:"currentColor"},null,-1),o("path",{d:"M464 126.51c-.81-27.65-24.18-52.4-66-69.85C359.74 40.76 309.34 32 256 32s-103.74 8.76-141.91 24.66c-41.78 17.41-65.15 42.11-66 69.69L48 144c0 6.41 5.2 16.48 14.63 24.73c11.13 9.73 27.65 19.33 47.78 27.73C153.24 214.36 207.67 225 256 225s102.76-10.68 145.59-28.58c20.13-8.4 36.65-18 47.78-27.73C458.8 160.49 464 150.42 464 144z",fill:"currentColor"},null,-1),o("path",{d:"M413.92 226c-46.53 19.43-105.57 31-157.92 31s-111.39-11.57-157.93-31c-17.07-7.15-31.69-18.79-43.64-28a4 4 0 0 0-6.43 3.22V232c0 6.41 5.2 14.48 14.63 22.73c11.13 9.74 27.65 19.33 47.78 27.74C153.24 300.34 207.67 311 256 311s102.76-10.68 145.59-28.57c20.13-8.41 36.65-18 47.78-27.74C458.8 246.47 464 238.41 464 232v-30.78a4 4 0 0 0-6.43-3.18c-11.95 9.17-26.57 20.81-43.65 27.96z",fill:"currentColor"},null,-1),o("path",{d:"M413.92 312c-46.54 19.41-105.57 31-157.92 31s-111.39-11.59-157.93-31c-17.07-7.17-31.69-18.81-43.64-28a4 4 0 0 0-6.43 3.2V317c0 6.41 5.2 14.47 14.62 22.71c11.13 9.74 27.66 19.33 47.79 27.74C153.24 385.32 207.66 396 256 396s102.76-10.68 145.59-28.57c20.13-8.41 36.65-18 47.78-27.74C458.8 331.44 464 323.37 464 317v-29.8a4 4 0 0 0-6.43-3.18c-11.95 9.17-26.57 20.81-43.65 27.98z",fill:"currentColor"},null,-1)]))}}),Me={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Pe=U({name:"Wifi",render:function(p,c){return m(),h("svg",Me,c[0]||(c[0]=[o("path",{d:"M346.65 304.3a136 136 0 0 0-180.71 0a21 21 0 1 0 27.91 31.38a94 94 0 0 1 124.89 0a21 21 0 0 0 27.91-31.4z",fill:"currentColor"},null,-1),o("path",{d:"M256.28 183.7a221.47 221.47 0 0 0-151.8 59.92a21 21 0 1 0 28.68 30.67a180.28 180.28 0 0 1 246.24 0a21 21 0 1 0 28.68-30.67a221.47 221.47 0 0 0-151.8-59.92z",fill:"currentColor"},null,-1),o("path",{d:"M462 175.86a309 309 0 0 0-411.44 0a21 21 0 1 0 28 31.29a267 267 0 0 1 355.43 0a21 21 0 0 0 28-31.31z",fill:"currentColor"},null,-1),o("circle",{cx:"256.28",cy:"393.41",r:"32",fill:"currentColor"},null,-1)]))}}),Ne={class:"row g-2"},Ue={class:"col-12 col-md-4"},ze={class:"d-flex align-items-center"},Be={class:"col-12 col-md-4"},Se={class:"d-flex align-items-center"},De={class:"col-12 col-md-4"},Te={class:"d-flex align-items-center"},$e={class:"row"},Ge={class:"col-md-6"},Ie={class:"col-md-6"},Fe={class:"row g-3"},Ve={class:"col-md-4"},je={class:"text-center"},Oe={class:"col-md-4"},He={class:"text-center"},Ae={class:"text-muted"},Le={class:"col-md-4"},Je={class:"text-center"},Ee={class:"text-muted"},Re={class:"row"},We={class:"d-flex justify-content-between align-items-center"},Ke={class:"row"},Qe={class:"col-md-6"},Ze={class:"col-md-3"},qe={class:"col-md-3"},Ye={__name:"box",setup(M){function p(i){return i>80?"#d03050":i>60?"#f0a020":"#18a058"}const c=oe();ae();const F=x([]),Z=document.cookie.split("; ").find(i=>i.startsWith("admin_token="))?.split("=")?.[1],q=window.server?.url||"";function n(i){try{return JSON.parse(i||"{}")}catch{return{}}}function j(i){navigator.clipboard.writeText(i),c.success(`已复制 ${i}`)}async function T(i,s={}){const f=`${q}/php/admin/index.php?action=${i}&token=${Z}`;return(await fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json()}async function X(){const{success:i,message:s}=await T("forceFetch");i?(c.success("已触发后端重新拉取，请稍候刷新页面"),setTimeout(z,3e3)):c.error(s||"触发失败")}async function z(){const{success:i,data:s,message:f}=await T("getServers");i?F.value=s.sort((P,D)=>P.pid-D.pid):c.error(f||"拉取失败")}z();const $=x(!1),Y=ne(()=>$.value?F.value:F.value.filter(i=>i.hide==0));async function ee(i){const{success:s,message:f}=await T("toggleHide",{id:i.id,hide:i.hide==0?1:0});s?(c.success("操作成功"),z()):c.error(f||"操作失败")}const B=x(!1),S=x(0);let O=null;function te(i){O=i,S.value=i.pid,B.value=!0}async function le(){if(S.value==null)return;const{success:i,message:s}=await T("changePid",{id:O.id,pid:S.value});i?(c.success("已更新"),B.value=!1,z()):c.error(s||"更新失败")}const V=x(!1),a=x(null),H=x([]);function se(i){a.value=i;const s=n(i.server_task_list)||[];H.value=s.sort((f,P)=>P.Memory-f.Memory).slice(0,20),V.value=!0}function _(i){const s=parseFloat(String(i).replace("%",""));return isNaN(s)?0:s}return(i,s)=>{const f=G("n-time"),P=G("n-alert"),D=G("n-statistic"),re=G("n-scrollbar");return m(),A(t(b),{title:"资源池管理"},{default:l(()=>[e(t(I),{style:{"margin-bottom":"16px"}},{default:l(()=>[e(t(w),{type:"primary",onClick:z},{icon:l(()=>[e(t(k),null,{default:l(()=>[e(t(Q))]),_:1})]),default:l(()=>[s[6]||(s[6]=d(" 刷新 "))]),_:1,__:[6]}),e(t(w),{type:"info",onClick:X},{icon:l(()=>[e(t(k),null,{default:l(()=>[e(t(Q))]),_:1})]),default:l(()=>[s[7]||(s[7]=d(" 重新拉取 "))]),_:1,__:[7]}),e(t(w),{onClick:s[0]||(s[0]=r=>$.value=!$.value)},{default:l(()=>[d(u($.value?"隐藏已隐藏":"显示已隐藏"),1)]),_:1})]),_:1}),e(t(ie),{responsive:"screen",cols:"1 600:2 900:3 1200:4","x-gap":12,"y-gap":12},{default:l(()=>[(m(!0),h(L,null,J(Y.value,r=>(m(),A(t(de),{key:r.id},{default:l(()=>[e(t(b),{hoverable:""},{header:l(()=>[e(t(ce),{style:{"max-width":"180px"}},{default:l(()=>[d(u(r.server_name),1)]),_:2},1024),e(t(N),{size:"small",type:r.status==="online"?"success":"error",style:{"margin-left":"auto"}},{default:l(()=>[d(u(r.status),1)]),_:2},1032,["type"])]),action:l(()=>[e(t(I),null,{default:l(()=>[e(t(w),{size:"tiny",onClick:g=>se(r)},{default:l(()=>s[11]||(s[11]=[d("详情")])),_:2,__:[11]},1032,["onClick"]),e(t(ue),{"positive-text":r.hide==0?"隐藏":"取消隐藏","negative-text":"取消",onPositiveClick:g=>ee(r)},{trigger:l(()=>[e(t(w),{size:"tiny",type:r.hide==0?"warning":"default"},{default:l(()=>[d(u(r.hide==0?"隐藏":"取消隐藏"),1)]),_:2},1032,["type"])]),default:l(()=>[d(" 确认"+u(r.hide==0?"隐藏":"取消隐藏")+"「"+u(r.server_name)+"」？ ",1)]),_:2},1032,["positive-text","onPositiveClick"]),e(t(w),{size:"tiny",type:"info",onClick:g=>te(r)},{default:l(()=>s[12]||(s[12]=[d(" 修改 PID ")])),_:2,__:[12]},1032,["onClick"])]),_:2},1024)]),default:l(()=>[e(t(v),{depth:"3",onClick:g=>j(r.server_ip),style:{cursor:"pointer"}},{default:l(()=>[e(t(k),{size:"14",style:{"vertical-align":"-2px"}},{default:l(()=>[e(t(K))]),_:1}),d(" "+u(r.server_ip),1)]),_:2},1032,["onClick"]),o("div",Ne,[o("div",Ue,[o("div",ze,[e(t(C),{type:"circle",percentage:_(n(r.server_cpu)?.ProcessorUsage||"0"),"stroke-width":6,width:40,color:"#2080f0"},null,8,["percentage"]),e(t(v),{class:"ms-2"},{default:l(()=>s[8]||(s[8]=[d("CPU")])),_:1,__:[8]})])]),o("div",Be,[o("div",Se,[e(t(C),{type:"circle",percentage:_(n(r.server_memory)?.UsedMemoryPercentage||"0"),"stroke-width":6,width:40,color:"#18a058"},null,8,["percentage"]),e(t(v),{class:"ms-2"},{default:l(()=>s[9]||(s[9]=[d("内存")])),_:1,__:[9]})])]),o("div",De,[o("div",Te,[e(t(C),{type:"circle",percentage:_(n(r.server_disk)?.TotalUsagePercentage||"0"),"stroke-width":6,width:40,color:"#f0a020"},null,8,["percentage"]),e(t(v),{class:"ms-2"},{default:l(()=>s[10]||(s[10]=[d("磁盘")])),_:1,__:[10]})])])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),e(t(_e),{show:B.value,"onUpdate:show":s[3]||(s[3]=r=>B.value=r),preset:"dialog",title:"修改排序 PID"},{action:l(()=>[e(t(w),{type:"primary",onClick:le},{default:l(()=>s[13]||(s[13]=[d("确认")])),_:1,__:[13]}),e(t(w),{onClick:s[2]||(s[2]=r=>B.value=!1)},{default:l(()=>s[14]||(s[14]=[d("取消")])),_:1,__:[14]})]),default:l(()=>[e(t(pe),{value:S.value,"onUpdate:value":s[1]||(s[1]=r=>S.value=r),placeholder:"请输入新的 pid",style:{width:"100%"}},null,8,["value"])]),_:1},8,["show"]),e(t(ve),{show:V.value,"onUpdate:show":s[5]||(s[5]=r=>V.value=r),placement:"right",style:{width:"85vw","max-width":"1200px"}},{default:l(()=>[e(t(me),{title:a.value?.server_name,closable:""},{default:l(()=>[e(re,{style:{"max-height":"calc(100vh - 100px)"}},{default:l(()=>[e(t(I),{vertical:""},{default:l(()=>[e(t(b),{title:"系统概览",size:"small"},{default:l(()=>[o("div",$e,[o("div",Ge,[e(t(E),{column:1,"label-placement":"left",bordered:""},{default:l(()=>[e(t(y),{label:"服务器名称"},{default:l(()=>[e(t(N),{type:"info"},{default:l(()=>[d(u(a.value?.server_name),1)]),_:1})]),_:1}),e(t(y),{label:"IP地址"},{default:l(()=>[e(t(I),{align:"center"},{default:l(()=>[e(t(v),{code:""},{default:l(()=>[d(u(a.value?.server_ip),1)]),_:1}),e(t(w),{text:"",type:"primary",onClick:s[4]||(s[4]=r=>j(a.value?.server_ip))},{default:l(()=>[e(t(k),null,{default:l(()=>[e(t(K))]),_:1})]),_:1})]),_:1})]),_:1}),e(t(y),{label:"操作系统"},{default:l(()=>[e(t(N),{type:"success"},{default:l(()=>[d(u(n(a.value?.server_data)?.OSName)+" "+u(n(a.value?.server_data)?.OSVersion)+" ("+u(n(a.value?.server_data)?.OSArchitecture)+") ",1)]),_:1})]),_:1}),e(t(y),{label:"计算机名"},{default:l(()=>[e(t(v),null,{default:l(()=>[d(u(n(a.value?.server_data)?.ComputerName),1)]),_:1})]),_:1}),e(t(y),{label:"主板"},{default:l(()=>[e(t(v),null,{default:l(()=>[d(u(n(a.value?.server_data)?.Motherboard),1)]),_:1})]),_:1})]),_:1})]),o("div",Ie,[e(t(E),{column:1,"label-placement":"left",bordered:""},{default:l(()=>[e(t(y),{label:"CPU型号"},{default:l(()=>[e(t(v),null,{default:l(()=>[d(u(n(a.value?.server_data)?.CPU),1)]),_:1})]),_:1}),e(t(y),{label:"内存插槽"},{default:l(()=>[e(t(v),null,{default:l(()=>[d(u(n(a.value?.server_data)?.Memory?.Count||0)+" 个物理内存插槽 ",1)]),_:1})]),_:1}),e(t(y),{label:"最后更新"},{default:l(()=>[e(f,{time:new Date(a.value?.updata_time),format:"yyyy-MM-dd HH:mm:ss"},null,8,["time"])]),_:1}),e(t(y),{label:"状态"},{default:l(()=>[e(t(N),{type:a.value?.status==="online"?"success":"error"},{default:l(()=>[d(u(a.value?.status),1)]),_:1},8,["type"])]),_:1})]),_:1})])])]),_:1}),e(t(b),{title:"资源使用情况",size:"small"},{default:l(()=>[o("div",Fe,[o("div",Ve,[o("div",je,[e(t(C),{type:"dashboard",percentage:_(n(a.value?.server_cpu)?.ProcessorUsage||0),color:p(_(n(a.value?.server_cpu)?.ProcessorUsage||0)),"indicator-text-color":p(_(n(a.value?.server_cpu)?.ProcessorUsage||0))},null,8,["percentage","color","indicator-text-color"]),s[15]||(s[15]=o("h6",{class:"mt-2"},"CPU使用率",-1)),e(t(v),{strong:""},{default:l(()=>[d(u(_(n(a.value?.server_cpu)?.ProcessorUsage||0))+"% ",1)]),_:1})])]),o("div",Oe,[o("div",He,[e(t(C),{type:"dashboard",percentage:_(n(a.value?.server_memory)?.UsedMemoryPercentage||0),color:p(_(n(a.value?.server_memory)?.UsedMemoryPercentage||0)),"indicator-text-color":p(_(n(a.value?.server_memory)?.UsedMemoryPercentage||0))},null,8,["percentage","color","indicator-text-color"]),s[16]||(s[16]=o("h6",{class:"mt-2"},"内存使用率",-1)),e(t(v),{strong:""},{default:l(()=>[d(u(_(n(a.value?.server_memory)?.UsedMemoryPercentage||0))+"% ",1),o("small",Ae," ("+u(n(a.value?.server_memory)?.FreePhysicalMemory||0)+"GB / "+u(n(a.value?.server_memory)?.TotalVisibleMemorySize||0)+"GB) ",1)]),_:1})])]),o("div",Le,[o("div",Je,[e(t(C),{type:"dashboard",percentage:_(n(a.value?.server_disk)?.TotalUsagePercentage||0),color:p(_(n(a.value?.server_disk)?.TotalUsagePercentage||0)),"indicator-text-color":p(_(n(a.value?.server_disk)?.TotalUsagePercentage||0))},null,8,["percentage","color","indicator-text-color"]),s[17]||(s[17]=o("h6",{class:"mt-2"},"磁盘使用率",-1)),e(t(v),{strong:""},{default:l(()=>[d(u(_(n(a.value?.server_disk)?.TotalUsagePercentage||0))+"% ",1),o("small",Ee," ("+u(n(a.value?.server_disk)?.TotalUsedGB||0)+"GB / "+u(n(a.value?.server_disk)?.TotalStorageSizeGB||0)+"GB) ",1)]),_:1})])])])]),_:1}),e(t(b),{title:"磁盘详情",size:"small"},{default:l(()=>[e(t(R),{columns:[{title:"盘符",key:"DriveLetter",align:"center"},{title:"容量",key:"SizeGB",render:r=>`${r.SizeGB}GB`},{title:"已用",key:"UsedGB",render:r=>`${r.UsedGB}GB`},{title:"使用率",key:"UsagePercentage",render:r=>W(t(C),{type:"line",percentage:parseFloat(r.UsagePercentage),indicatorPlacement:"inside",color:p(parseFloat(r.UsagePercentage))})},{title:"文件系统",key:"FileSystemLabel"},{title:"显示名称",key:"DisplayName"}],data:n(a.value?.server_disk)?.Volumes||[],size:"small",pagination:!1},null,8,["columns","data"]),e(t(fe),{dashed:""},{default:l(()=>s[18]||(s[18]=[d("物理磁盘")])),_:1,__:[18]}),o("div",Re,[(m(!0),h(L,null,J(n(a.value?.server_disk)?.PerDiskSizes||[],r=>(m(),h("div",{key:r.DeviceId,class:"col-md-6 mb-2"},[e(P,{type:"info",class:"mb-2"},{icon:l(()=>[e(t(k),null,{default:l(()=>[e(t(Ce))]),_:1})]),default:l(()=>[o("div",We,[o("span",null,u(r.FriendlyName)+" ("+u(r.MediaType)+")",1),e(t(N),null,{default:l(()=>[d(u(r.SizeGB)+"GB",1)]),_:2},1024)])]),_:2},1024)]))),128))])]),_:1}),e(t(b),{title:"网络信息",size:"small"},{default:l(()=>[o("div",Ke,[o("div",Qe,[e(D,{label:"网络接口",value:n(a.value?.server_network)?.Name},{suffix:l(()=>[e(t(k),null,{default:l(()=>[e(t(Pe))]),_:1})]),_:1},8,["value"])]),o("div",Ze,[e(D,{label:"上传速率"},{prefix:l(()=>[e(t(k),{color:"#18a058"},{default:l(()=>[e(t(he))]),_:1})]),default:l(()=>[d(u(n(a.value?.server_network)?.Statistics?.["Upload(Mbps)"]?.toFixed(2)||0)+" Mbps ",1)]),_:1})]),o("div",qe,[e(D,{label:"下载速率"},{prefix:l(()=>[e(t(k),{color:"#2080f0"},{default:l(()=>[e(t(we))]),_:1})]),default:l(()=>[d(u(n(a.value?.server_network)?.Statistics?.["Download(Mbps)"]?.toFixed(2)||0)+" Mbps ",1)]),_:1})])])]),_:1}),e(t(b),{title:"进程列表 TOP20",size:"small"},{default:l(()=>[e(t(R),{columns:[{title:"PID",key:"Id",width:70,align:"center",sorter:(r,g)=>r.Id-g.Id},{title:"进程名",key:"ProcessName",ellipsis:{tooltip:!0},sorter:(r,g)=>r.ProcessName.localeCompare(g.ProcessName)},{title:"内存(MB)",key:"Memory",width:100,align:"center",sorter:(r,g)=>g.Memory-r.Memory,render:r=>W(t(N),{type:r.Memory>100?"error":r.Memory>50?"warning":"success"},()=>`${r.Memory.toFixed(2)} MB`)}],data:H.value,size:"small",pagination:{pageSize:10},"scroll-x":600,striped:""},null,8,["columns","data"])]),_:1})]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])]),_:1})}}};export{Ye as default};
