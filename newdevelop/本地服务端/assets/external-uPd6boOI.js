import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{d as D,c as q,o as C,a as N,l as F,r as u,b8 as H,e as J,g as L,w as n,h as l,j as a,bw as z,by as p,i as x,bt as W,bu as A,bD as E,bE as V,bF as R,bG as c,bx as k,bR as G,bH as K,br as Q,b7 as f,bJ as X}from"./index-C5I1O8sb.js";const Y={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Z=D({name:"Add",render:function(o,r){return C(),q("svg",Y,r[0]||(r[0]=[N("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 112v288"},null,-1),N("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M400 256H112"},null,-1)]))}}),ee={__name:"external",setup($){const o=F(),r=document.cookie.split("; ").find(s=>s.startsWith("admin_token="))?.split("=")[1],v=window.server.url+"/php/admin/index.php",h=u([]),y=H({page:1,pageSize:10,showSizePicker:!0,pageSizes:[10,20,50]}),j=u([]),S=u([]),d=u(!1),b=u("添加商品"),w=u(!1),i=u({id:null,name:"",zyid:null,link:"",rdplink:"",pid:0,yuan:""}),T=[{title:"ID",key:"id",width:70,fixed:"left"},{title:"商品名称",key:"name",minWidth:160,ellipsis:{tooltip:!0}},{title:"服务器ID",key:"zyid",width:90},{title:"链接",key:"link",minWidth:260,ellipsis:{tooltip:!0}},{title:"远程桌面链接",key:"rdplink",minWidth:260,ellipsis:{tooltip:!0}},{title:"排序",key:"pid",width:80,sorter:(s,e)=>e.pid-s.pid},{title:"原价",key:"yuan",width:100},{title:"操作",key:"actions",width:180,fixed:"right",render(s){return f(z,{size:6},()=>[f(p,{size:"small",type:Number(s.hide)===1?"success":"warning",onClick:()=>O(s.id,Number(s.hide)===1?0:1)},()=>Number(s.hide)===1?"显示":"隐藏"),f(p,{size:"small",type:"primary",onClick:()=>U(s)},()=>"编辑"),f(X,{onPositiveClick:()=>M(s.id),positiveText:"确认",negativeText:"取消"},{trigger:()=>f(p,{size:"small",type:"error"},()=>"删除"),default:()=>"确定删除该商品吗？"})])}}];async function g(){try{const e=await(await fetch(`${v}?action=getShopList&token=${r}`)).json();e.success?h.value=e.data.sort((t,m)=>m.pid-t.pid):o.error(e.message)}catch{o.error("获取商品列表失败")}}async function _(){try{const e=await(await fetch(`${v}?action=getServers&token=${r}`)).json();e.success?(j.value=e.data,S.value=e.data.map(t=>({label:`${t.server_name} (ID:${t.id})`,value:t.id.toString()}))):o.error(e.message)}catch{o.error("获取服务器列表失败")}}function I(){w.value=!1,b.value="添加商品",i.value={id:null,name:"",zyid:null,link:"",pid:0,yuan:""},d.value=!0}function U(s){w.value=!0,b.value="编辑商品",i.value={...s},d.value=!0}async function B(){if(!i.value.name||!i.value.zyid||!i.value.link){o.error("请填写必填项");return}const s=w.value?"editShop":"addShop";try{const t=await(await fetch(`${v}?action=${s}&token=${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i.value)})).json();t.success?(o.success(t.message),d.value=!1,g()):o.error(t.message)}catch{o.error("提交失败")}}async function M(s){try{const t=await(await fetch(`${v}?action=deleteShop&token=${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:s})})).json();t.success?(o.success(t.message),g()):o.error(t.message)}catch{o.error("删除失败")}}async function O(s,e){try{const m=await(await fetch(`${v}?action=toggleShopHide&token=${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:s,hide:e})})).json();m.success?(o.success(m.message),g()):o.error(m.message)}catch{o.error("切换失败")}}return J(()=>{g(),_()}),(s,e)=>(C(),L(a(Q),{title:"资源外放商品管理"},{default:n(()=>[l(a(z),{justify:"space-between",class:"mb-3"},{default:n(()=>[l(a(p),{type:"primary",onClick:I},{icon:n(()=>[l(a(W),null,{default:n(()=>[l(a(Z))]),_:1})]),default:n(()=>[e[10]||(e[10]=x(" 添加商品 "))]),_:1,__:[10]})]),_:1}),l(a(A),{columns:T,data:h.value,"max-height":600,"scroll-x":1e3,striped:"",size:"medium",class:"shop-table"},null,8,["data"]),l(a(E),{page:y.page,"onUpdate:page":e[0]||(e[0]=t=>y.page=t),"page-size":y.pageSize,"onUpdate:pageSize":e[1]||(e[1]=t=>y.pageSize=t),"item-count":h.value.length,"page-sizes":[10,20,50],"show-size-picker":"",style:{"margin-top":"12px","justify-content":"flex-end"}},null,8,["page","page-size","item-count"]),l(a(V),{show:d.value,"onUpdate:show":e[9]||(e[9]=t=>d.value=t),preset:"dialog",title:b.value,style:{width:"480px"}},{action:n(()=>[l(a(p),{onClick:e[8]||(e[8]=t=>d.value=!1)},{default:n(()=>e[11]||(e[11]=[x("取消")])),_:1,__:[11]}),l(a(p),{type:"primary",onClick:B},{default:n(()=>e[12]||(e[12]=[x("保存")])),_:1,__:[12]})]),default:n(()=>[l(a(R),{model:i.value,"label-placement":"left","label-width":"100px"},{default:n(()=>[l(a(c),{label:"商品名称",required:""},{default:n(()=>[l(a(k),{value:i.value.name,"onUpdate:value":e[2]||(e[2]=t=>i.value.name=t),placeholder:"请输入商品名称"},null,8,["value"])]),_:1}),l(a(c),{label:"关联服务器",required:""},{default:n(()=>[l(a(G),{value:i.value.zyid,"onUpdate:value":e[3]||(e[3]=t=>i.value.zyid=t),options:S.value,placeholder:"请选择服务器"},null,8,["value","options"])]),_:1}),l(a(c),{label:"链接",required:""},{default:n(()=>[l(a(k),{value:i.value.link,"onUpdate:value":e[4]||(e[4]=t=>i.value.link=t),placeholder:"请输入接口链接"},null,8,["value"])]),_:1}),l(a(c),{label:"远程桌面链接",required:""},{default:n(()=>[l(a(k),{value:i.value.rdplink,"onUpdate:value":e[5]||(e[5]=t=>i.value.rdplink=t),placeholder:"请输入远程桌面链接"},null,8,["value"])]),_:1}),l(a(c),{label:"排序值"},{default:n(()=>[l(a(K),{value:i.value.pid,"onUpdate:value":e[6]||(e[6]=t=>i.value.pid=t),min:0,placeholder:"排序值越大越靠前"},null,8,["value"])]),_:1}),l(a(c),{label:"原价"},{default:n(()=>[l(a(k),{value:i.value.yuan,"onUpdate:value":e[7]||(e[7]=t=>i.value.yuan=t),placeholder:"请输入原价"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])]),_:1}))}},le=P(ee,[["__scopeId","data-v-feac2b21"]]);export{le as default};
