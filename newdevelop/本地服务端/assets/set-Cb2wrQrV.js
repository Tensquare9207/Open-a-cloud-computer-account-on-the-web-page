import{l as C,r as g,e as x,g as U,o as w,w as u,h as l,j as a,bT as P,bU as m,bF as b,bG as o,bx as d,by as y,i as c,bH as E,bR as J,bV as F,c as I,F as L,k as B,bW as Q,bS as N,br as M}from"./index-C5I1O8sb.js";const G={__name:"set",setup(R){const r=document.cookie.split("; ").find(n=>n.startsWith("admin_token="))?.split("=")[1],f=window.server.url+"/php/admin/index.php",p=C(),_=[{label:"无",value:""},{label:"SSL",value:"ssl"},{label:"TLS",value:"tls"}],s=g({webname:"",logo:"",icon:"",notify:"",notifyEnabled:!1}),i=g({host:"",username:"",password:"",port:465,secure:"ssl",mail:"",name:"",topic:""}),S=g([]),k=n=>({wxpay:"微信支付",alipay:"支付宝",QQpay:"QQ钱包"})[n]||n,O=()=>{fetch(`${f}?action=getpay&token=${r}`).then(n=>n.json()).then(n=>{if(!n.success)return p.error(n.message||"获取码支付失败");S.value=n.data.map(e=>({name:e.name,status:e.status==="true"||e.status==="1",config:(()=>{try{const t=e.config.replace(/<[^>]*>/g,"").replace(/'/g,'"');return JSON.parse(t||"{}")}catch{return{apiurl:"",pid:"",key:""}}})()}))})},$=n=>{fetch(`${f}?action=sevepay&token=${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n.name,config:JSON.stringify(n.config),status:n.status})}).then(e=>e.json()).then(e=>e.success?p.success(`${k(n.name)} 配置已保存`):p.error(e.message||"保存失败"))};x(()=>{fetch(`${f}?action=getSettings&token=${r}`).then(n=>n.json()).then(n=>{if(!n.success)return p.error(n.message);const e=Object.fromEntries(n.data.map(t=>[t.name,t.config]));s.value.webname=e.webname||"",s.value.logo=e.logo||"",s.value.icon=e.icon||"";try{Object.assign(i.value,JSON.parse(e.email||"{}"))}catch{}}),fetch(`${f}?action=getSettings3&token=${r}`).then(n=>n.json()).then(n=>{if(!n.success)return p.error(n.message);const e=n.data.find(t=>t.name==="notify");e&&(s.value.notify=e.config||"",s.value.notifyEnabled=e.status==="1")}),O()});const T=()=>{Promise.all(["webname","logo","icon","notify"].map(n=>fetch(`${f}?action=setSetting&token=${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n,config:s.value[n]})}).then(e=>e.json()))).then(()=>p.success("系统设置已保存"))},h=()=>{Promise.all(["notify"].map(n=>fetch(`${f}?action=setSetting3&token=${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n,config:s.value[n],status:s.value.notifyEnabled?"1":"0"})}).then(e=>e.json()))).then(()=>p.success("公告设置已保存"))},j=()=>{fetch(`${f}?action=setSetting&token=${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"email",config:JSON.stringify(i.value)})}).then(n=>n.json()).then(n=>n.success?p.success("邮件设置已保存"):p.error(n.message||"保存失败"))};return(n,e)=>(w(),U(a(M),{title:"设置"},{default:u(()=>[l(a(P),{type:"line",animated:""},{default:u(()=>[l(a(m),{name:"system",tab:"系统设置"},{default:u(()=>[l(a(b),{model:s.value,"label-placement":"left","label-width":"80"},{default:u(()=>[l(a(o),{label:"网站名称"},{default:u(()=>[l(a(d),{value:s.value.webname,"onUpdate:value":e[0]||(e[0]=t=>s.value.webname=t)},null,8,["value"])]),_:1}),l(a(o),{label:"LOGO"},{default:u(()=>[l(a(d),{value:s.value.logo,"onUpdate:value":e[1]||(e[1]=t=>s.value.logo=t)},null,8,["value"])]),_:1}),l(a(o),{label:"网站图标"},{default:u(()=>[l(a(d),{value:s.value.icon,"onUpdate:value":e[2]||(e[2]=t=>s.value.icon=t)},null,8,["value"])]),_:1}),l(a(o),null,{default:u(()=>[l(a(y),{type:"primary",onClick:T},{default:u(()=>e[13]||(e[13]=[c("保存")])),_:1,__:[13]})]),_:1})]),_:1},8,["model"])]),_:1}),l(a(m),{name:"email",tab:"邮件设置"},{default:u(()=>[l(a(b),{model:i.value,"label-placement":"left","label-width":"100"},{default:u(()=>[l(a(o),{label:"SMTP 主机"},{default:u(()=>[l(a(d),{value:i.value.host,"onUpdate:value":e[3]||(e[3]=t=>i.value.host=t)},null,8,["value"])]),_:1}),l(a(o),{label:"用户名"},{default:u(()=>[l(a(d),{value:i.value.username,"onUpdate:value":e[4]||(e[4]=t=>i.value.username=t)},null,8,["value"])]),_:1}),l(a(o),{label:"密码"},{default:u(()=>[l(a(d),{value:i.value.password,"onUpdate:value":e[5]||(e[5]=t=>i.value.password=t),type:"password","show-password-on":"click"},null,8,["value"])]),_:1}),l(a(o),{label:"端口"},{default:u(()=>[l(a(E),{value:i.value.port,"onUpdate:value":e[6]||(e[6]=t=>i.value.port=t),min:1,max:65535},null,8,["value"])]),_:1}),l(a(o),{label:"加密方式"},{default:u(()=>[l(a(J),{value:i.value.secure,"onUpdate:value":e[7]||(e[7]=t=>i.value.secure=t),options:_},null,8,["value"])]),_:1}),l(a(o),{label:"发件邮箱"},{default:u(()=>[l(a(d),{value:i.value.mail,"onUpdate:value":e[8]||(e[8]=t=>i.value.mail=t)},null,8,["value"])]),_:1}),l(a(o),{label:"发件人名称"},{default:u(()=>[l(a(d),{value:i.value.name,"onUpdate:value":e[9]||(e[9]=t=>i.value.name=t)},null,8,["value"])]),_:1}),l(a(o),{label:"邮件主题"},{default:u(()=>[l(a(d),{value:i.value.topic,"onUpdate:value":e[10]||(e[10]=t=>i.value.topic=t)},null,8,["value"])]),_:1}),l(a(o),null,{default:u(()=>[l(a(y),{type:"primary",onClick:j},{default:u(()=>e[14]||(e[14]=[c("保存")])),_:1,__:[14]})]),_:1})]),_:1},8,["model"])]),_:1}),l(a(m),{name:"pay",tab:"码支付"},{default:u(()=>[l(a(F),{accordion:""},{default:u(()=>[(w(!0),I(L,null,B(S.value,t=>(w(),U(a(Q),{key:t.name,title:k(t.name)},{default:u(()=>[l(a(b),{model:t.config,"label-placement":"left","label-width":"100"},{default:u(()=>[l(a(o),{label:"接口地址"},{default:u(()=>[l(a(d),{value:t.config.apiurl,"onUpdate:value":v=>t.config.apiurl=v},null,8,["value","onUpdate:value"])]),_:2},1024),l(a(o),{label:"商户ID"},{default:u(()=>[l(a(d),{value:t.config.pid,"onUpdate:value":v=>t.config.pid=v},null,8,["value","onUpdate:value"])]),_:2},1024),l(a(o),{label:"通信密钥"},{default:u(()=>[l(a(d),{value:t.config.key,"onUpdate:value":v=>t.config.key=v,type:"password","show-password-on":"click"},null,8,["value","onUpdate:value"])]),_:2},1024),l(a(o),{label:"启用"},{default:u(()=>[l(a(N),{value:t.status,"onUpdate:value":v=>t.status=v},null,8,["value","onUpdate:value"])]),_:2},1024),l(a(o),null,{default:u(()=>[l(a(y),{type:"primary",onClick:v=>$(t)},{default:u(()=>e[15]||(e[15]=[c("保存")])),_:2,__:[15]},1032,["onClick"])]),_:2},1024)]),_:2},1032,["model"])]),_:2},1032,["title"]))),128))]),_:1})]),_:1}),l(a(m),{name:"notify",tab:"公告"},{default:u(()=>[l(a(b),{model:s.value,"label-placement":"left","label-width":"80"},{default:u(()=>[l(a(o),{label:"网站公告"},{default:u(()=>[l(a(d),{value:s.value.notify,"onUpdate:value":e[11]||(e[11]=t=>s.value.notify=t),type:"textarea",autosize:{minRows:4,maxRows:8},placeholder:"请输入公告内容，支持换行"},null,8,["value"])]),_:1}),l(a(o),{label:"启用公告"},{default:u(()=>[l(a(N),{value:s.value.notifyEnabled,"onUpdate:value":e[12]||(e[12]=t=>s.value.notifyEnabled=t)},null,8,["value"])]),_:1}),l(a(o),null,{default:u(()=>[l(a(y),{type:"primary",onClick:h},{default:u(()=>e[16]||(e[16]=[c("保存")])),_:1,__:[16]})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1}))}};export{G as default};
