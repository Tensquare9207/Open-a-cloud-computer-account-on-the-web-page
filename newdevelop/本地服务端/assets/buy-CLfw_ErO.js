import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{bv as I,l as M,r as v,e as z,c as H,o as J,h as a,w as n,j as t,bw as $,by as d,i as g,bu as A,b7 as h,br as L,bF as j,bG as r,bx as m,bH as T,bE as S,F as V,bS as G}from"./index-C5I1O8sb.js";const W={__name:"buy",setup(q){const k=I(),o=M(),y=document.cookie.split("; ").find(s=>s.startsWith("admin_token="))?.split("=")[1],f=window.server?.url||"",N=v([]),p=v(!1),c=v(!1),b=v(!1),i=v({name:"",yuan:"",password:"",pid:0}),u=v({id:null,name:"",yuan:"",password:"",pid:0}),w=async()=>{p.value=!0;try{const e=await(await fetch(`${f}/php/admin/index.php?action=getBuyList&token=${y}`)).json();e.success?N.value=e.data:o.error(e.message||"获取数据失败")}catch{o.error("网络请求异常")}finally{p.value=!1}},U=()=>{i.value={name:"",yuan:"",password:"",pid:0},c.value=!0},_=async()=>{if(!i.value.name||!i.value.yuan)return o.warning("请填写必填项");try{const e=await(await fetch(`${f}/php/admin/index.php?action=addBuy&token=${y}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i.value)})).json();e.success?(o.success("添加成功"),c.value=!1,w()):o.error(e.message||"添加失败")}catch{o.error("网络请求异常")}},B=s=>{u.value={...s},b.value=!0},O=async()=>{if(!u.value.name||!u.value.yuan)return o.warning("请填写必填项");try{const e=await(await fetch(`${f}/php/admin/index.php?action=editBuy&token=${y}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u.value)})).json();e.success?(o.success("编辑成功"),b.value=!1,w()):o.error(e.message||"编辑失败")}catch{o.error("网络请求异常")}},x=s=>{const e=Number(s.hide),l=e===1?"显示":"隐藏";k.warning({title:"提示",content:`确定要${l}「${s.name}」吗？`,positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{const C=await(await fetch(`${f}/php/admin/index.php?action=toggleBuyHide&token=${y}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:s.id,hide:e===1?0:1})})).json();C.success?(o.success(`${l}成功`),w()):o.error(C.message||"操作失败")}catch{o.error("网络请求异常")}}})},F=s=>{k.warning({title:"警告",content:`确定要删除「${s.name}」吗？`,positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{try{const l=await(await fetch(`${f}/php/admin/index.php?action=delBuy&token=${y}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:s.id})})).json();l.success?(o.success("删除成功"),w()):o.error(l.message||"删除失败")}catch{o.error("网络请求异常")}}})},P=[{title:"ID",key:"id",width:60},{title:"名称",key:"name",width:200},{title:"金额",key:"yuan",width:100},{title:"密码",key:"password",width:150},{title:"排序",key:"pid",width:80},{title:"状态",key:"hide",width:80,render:s=>h(G,{value:Number(s.hide)===1,"on-update:value":e=>x(s)})},{title:"操作",key:"actions",width:280,render:s=>h($,{align:"center"},[h(d,{size:"small",type:"primary",onClick:()=>B(s),disabled:p.value},"编辑"),h(d,{size:"small",type:"error",onClick:()=>F(s),disabled:p.value},"删除"),h(d,{size:"small",type:Number(s.hide)===1?"success":"warning",onClick:()=>x(s),disabled:p.value},Number(s.hide)===1?"显示":"隐藏")])}];return z(()=>{w()}),(s,e)=>(J(),H(V,null,[a(t(L),{title:"商品池管理"},{default:n(()=>[a(t($),{vertical:""},{default:n(()=>[a(t(d),{type:"primary",onClick:U},{default:n(()=>e[12]||(e[12]=[g("添加商品")])),_:1,__:[12]}),a(t(A),{columns:P,data:N.value,loading:p.value,pagination:{pageSize:10},style:{tableLayout:"fixed"}},null,8,["data","loading"])]),_:1})]),_:1}),a(t(S),{show:c.value,"onUpdate:show":e[5]||(e[5]=l=>c.value=l),preset:"dialog",title:"添加商品"},{action:n(()=>[a(t(d),{onClick:e[4]||(e[4]=l=>c.value=!1)},{default:n(()=>e[13]||(e[13]=[g("取消")])),_:1,__:[13]}),a(t(d),{type:"primary",onClick:_},{default:n(()=>e[14]||(e[14]=[g("添加")])),_:1,__:[14]})]),default:n(()=>[a(t(j),{model:i.value,"label-placement":"left","label-width":"80"},{default:n(()=>[a(t(r),{label:"名称"},{default:n(()=>[a(t(m),{value:i.value.name,"onUpdate:value":e[0]||(e[0]=l=>i.value.name=l)},null,8,["value"])]),_:1}),a(t(r),{label:"金额"},{default:n(()=>[a(t(m),{value:i.value.yuan,"onUpdate:value":e[1]||(e[1]=l=>i.value.yuan=l)},null,8,["value"])]),_:1}),a(t(r),{label:"密码"},{default:n(()=>[a(t(m),{value:i.value.password,"onUpdate:value":e[2]||(e[2]=l=>i.value.password=l)},null,8,["value"])]),_:1}),a(t(r),{label:"排序"},{default:n(()=>[a(t(T),{value:i.value.pid,"onUpdate:value":e[3]||(e[3]=l=>i.value.pid=l)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),a(t(S),{show:b.value,"onUpdate:show":e[11]||(e[11]=l=>b.value=l),preset:"dialog",title:"编辑商品"},{action:n(()=>[a(t(d),{onClick:e[10]||(e[10]=l=>b.value=!1)},{default:n(()=>e[15]||(e[15]=[g("取消")])),_:1,__:[15]}),a(t(d),{type:"primary",onClick:O},{default:n(()=>e[16]||(e[16]=[g("保存")])),_:1,__:[16]})]),default:n(()=>[a(t(j),{model:u.value,"label-placement":"left","label-width":"80"},{default:n(()=>[a(t(r),{label:"名称"},{default:n(()=>[a(t(m),{value:u.value.name,"onUpdate:value":e[6]||(e[6]=l=>u.value.name=l)},null,8,["value"])]),_:1}),a(t(r),{label:"金额"},{default:n(()=>[a(t(m),{value:u.value.yuan,"onUpdate:value":e[7]||(e[7]=l=>u.value.yuan=l)},null,8,["value"])]),_:1}),a(t(r),{label:"密码"},{default:n(()=>[a(t(m),{value:u.value.password,"onUpdate:value":e[8]||(e[8]=l=>u.value.password=l)},null,8,["value"])]),_:1}),a(t(r),{label:"排序"},{default:n(()=>[a(t(T),{value:u.value.pid,"onUpdate:value":e[9]||(e[9]=l=>u.value.pid=l)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])],64))}},R=E(W,[["__scopeId","data-v-82e57c9f"]]);export{R as default};
