import{l as $,r as d,e as x,g as h,o as y,w as s,a as c,h as l,j as n,br as C,bG as b,c5 as U,bw as B,c as D,F as E,k as W,c6 as j,i as o,t as I,bH as M,by as P,bE as F,bo as L}from"./index-C5I1O8sb.js";const O={class:"container py-4"},S={class:"row justify-content-center"},V={class:"col-12 col-md-8 col-lg-6"},Q={__name:"pay",setup(q){const v=window.server?.url||"",f=()=>document.cookie.split("; ").find(a=>a.startsWith("user_token="))?.split("=")[1],r=$(),m=d([]),u=d(""),i=d(1),p=d(!1),w=d("");x(_);async function _(){try{const a=await fetch(`${v}/php/user/index.php?action=getpay&token=${f()}`).then(e=>e.json());if(a.success)m.value=a.data;else throw new Error(a.message||"加载支付渠道失败")}catch(a){r.error(a.message)}}function k(){if(!u.value||!i.value)return;const a=`CZ${Date.now()}${Math.random().toString(36).slice(-4)}`.toUpperCase();w.value=a;const e=`${v}/pay/epayapi.php?action=pay&token=${f()}&WIDout_trade_no=${a}&WIDtotal_fee=${i.value}&type=${u.value}`;window.open(e,"_blank"),p.value=!0}async function g(){try{const a=await fetch(`${v}/php/user/index.php?action=checkOrder&order=${w.value}&token=${f()}`).then(e=>e.json());return a.success&&a.paid?(r.success("充值成功，感谢您的支持！"),window.dispatchEvent(new CustomEvent("balance:refresh")),!0):(r.warning("订单尚未支付，请稍后再试"),!1)}catch(a){return r.error(a.message||"查询失败"),!1}}function N(){r.info("支付已取消，如有疑问请联系客服。"),p.value=!1}return(a,e)=>(y(),h(n(L),{theme:null},{default:s(()=>[c("div",O,[c("div",S,[c("div",V,[l(n(C),{title:"账户充值"},{default:s(()=>[l(n(b),{label:"选择支付方式",required:""},{default:s(()=>[l(n(U),{value:u.value,"onUpdate:value":e[0]||(e[0]=t=>u.value=t),name:"payWay"},{default:s(()=>[l(n(B),null,{default:s(()=>[(y(!0),D(E,null,W(m.value,t=>(y(),h(n(j),{key:t.name,value:t.name,disabled:t.status!=="1"},{default:s(()=>[o(I(t.name==="wxpay"?"微信支付":t.name==="alipay"?"支付宝":"QQ 钱包"),1)]),_:2},1032,["value","disabled"]))),128))]),_:1})]),_:1},8,["value"])]),_:1}),l(n(b),{label:"充值金额",required:""},{default:s(()=>[l(n(M),{value:i.value,"onUpdate:value":e[1]||(e[1]=t=>i.value=t),precision:2,min:.01,placeholder:"请输入金额",style:{width:"100%"}},{prefix:s(()=>e[3]||(e[3]=[o("￥")])),_:1},8,["value"])]),_:1}),l(n(P),{type:"primary",block:"",disabled:!u.value||!i.value,onClick:k},{default:s(()=>e[4]||(e[4]=[o(" 立即支付 ")])),_:1,__:[4]},8,["disabled"])]),_:1})])])]),l(n(F),{show:p.value,"onUpdate:show":e[2]||(e[2]=t=>p.value=t),preset:"dialog",type:"success",title:"支付确认",closable:!1,"mask-closable":!1,"positive-text":"已完成支付","negative-text":"取消支付",onPositiveClick:g,onNegativeClick:N},{default:s(()=>e[5]||(e[5]=[o(" 请在新的窗口完成支付，支付完成后点击“已完成支付”。"),c("br",null,null,-1),o(" 如未弹出窗口，请检查浏览器是否拦截。"),c("br",null,null,-1),o(" 一定要点！不然余额不会更新！ ")])),_:1,__:[5]},8,["show"])]),_:1}))}};export{Q as default};
