import{bv as le,l as ne,r as p,aZ as A,e as oe,b8 as h,f as ue,g as G,o as F,w as a,h as s,j as t,bw as m,bx as v,by as d,i as o,bz as de,c as ie,F as re,k as pe,bA as fe,br as Q,bB as me,t as w,bC as $,bD as ve,bE as z,bF as O,bG as y,bH as ye}from"./index-C5I1O8sb.js";const be={__name:"User",setup(ge){const g=n=>{const e=document.cookie.split("; ").find(f=>f.startsWith("admin_token="))?.split("=")[1];return window.server.url+`/php/admin/index.php?action=${n}&token=${e}`},M=le(),u=ne(),P=p([]),_=p(""),c=p(1),x=p(8),D=A(()=>P.value.filter(n=>n.username.includes(_.value)||n.QQ?.includes(_.value)||n.email?.includes(_.value))),Y=A(()=>D.value.slice((c.value-1)*x.value,c.value*x.value)),b=()=>fetch(g("list")).then(n=>n.json()).then(n=>{n.success?P.value=n.data:u.error(n.message)});oe(b);const N=p(!1),i=h({username:"",QQ:"",email:"",password:""}),J={username:{required:!0,message:"请输入用户名",trigger:"blur"},password:{required:!0,message:"请输入密码",trigger:"blur"}},q=p(),H=()=>{q.value?.validate(n=>{n||fetch(g("add"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then(e=>e.json()).then(e=>{e.success?(u.success(e.message),N.value=!1,i.username=i.QQ=i.email=i.password="",b()):u.error(e.message)})})},j=p(!1),r=h({id:null,username:"",QQ:"",email:""}),B=p(),L=n=>{r.id=n.id,r.username=n.username,r.QQ=n.QQ||"",r.email=n.email||"",j.value=!0},R=()=>{B.value?.validate(n=>{n||fetch(g("edit"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(e=>e.json()).then(e=>{e.success?(u.success(e.message),j.value=!1,b()):u.error(e.message)})})},S=p(!1),k=h({id:null,password:""}),V={password:{required:!0,message:"请输入新密码",trigger:"blur"}},E=p(),W=n=>{k.id=n.id,k.password="",S.value=!0},Z=()=>{E.value?.validate(n=>{n||fetch(g("pwd"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(k)}).then(e=>e.json()).then(e=>{e.success?(u.success(e.message),S.value=!1):u.error(e.message)})})},U=p(!1),C=h({id:null,yuan:0}),K={yuan:{type:"number",required:!0,message:"请输入余额",trigger:"blur"}},I=p(),X=n=>{C.id=n.id,C.yuan=n.yuan,U.value=!0},ee=()=>{I.value?.validate(n=>{n||fetch(g("yuan"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(C)}).then(e=>e.json()).then(e=>{e.success?(u.success(e.message),U.value=!1,b()):u.error(e.message)})})},te=n=>{let e;n.status==="0"?e=1:n.status==="1"&&(e=0),e!==void 0&&fetch(g("ban"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:n.id,status:e})}).then(f=>f.json()).then(f=>{f.success?(u.success(f.message),b()):u.error(f.message)})},se=n=>{fetch(g("force"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uid:n})}).then(e=>e.json()).then(e=>{e.success?(u.success(e.message),document.cookie=`user_token=${n}; path=/`):u.error(e.message)})},ae=n=>{M.warning({title:"确认删除",content:`确定要删除用户 ${n.username} 吗？此操作不可撤销！`,positiveText:"删除",negativeText:"取消",onPositiveClick:()=>{fetch(g("delete"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:n.id})}).then(e=>e.json()).then(e=>{e.success?(u.success(e.message),b()):u.error(e.message)})}})};return(n,e)=>{const f=ue("n-avatar");return F(),G(t(Q),{title:"用户管理"},{default:a(()=>[s(t(m),{vertical:""},{default:a(()=>[s(t(m),{justify:"space-between"},{default:a(()=>[s(t(v),{value:_.value,"onUpdate:value":e[0]||(e[0]=l=>_.value=l),placeholder:"搜索用户名 / QQ / 邮箱",style:{width:"300px"},clearable:""},null,8,["value"]),s(t(d),{type:"primary",onClick:e[1]||(e[1]=l=>N.value=!0)},{default:a(()=>e[21]||(e[21]=[o("添加用户")])),_:1,__:[21]})]),_:1}),s(t(de),{"x-gap":12,"y-gap":12,cols:"1 600:2 900:3 1200:4"},{default:a(()=>[(F(!0),ie(re,null,pe(Y.value,l=>(F(),G(t(fe),{key:l.id},{default:a(()=>[s(t(Q),null,{default:a(()=>[s(t(m),{vertical:""},{default:a(()=>[s(t(m),{align:"center",wrap:!1},{default:a(()=>[s(f,{size:64,src:`https://q2.qlogo.cn/headimg_dl?dst_uin=${l.QQ||0}&spec=100`,"fallback-src":"https://via.placeholder.com/64"},null,8,["src"]),s(t(me),{style:{margin:"0"}},{default:a(()=>[o(w(l.username),1)]),_:2},1024)]),_:2},1024),s(t($),{depth:"3"},{default:a(()=>[o("QQ："+w(l.QQ||"-"),1)]),_:2},1024),s(t($),{depth:"3"},{default:a(()=>[o("邮箱："+w(l.email||"-"),1)]),_:2},1024),s(t($),{depth:"3"},{default:a(()=>[o("UID："+w(l.uid),1)]),_:2},1024),s(t($),{depth:"3"},{default:a(()=>[o("余额："+w(l.yuan),1)]),_:2},1024),s(t($),{type:l.status==="1"?"error":"success"},{default:a(()=>[o(" 状态："+w(l.status==="0"?"正常":"已封禁"),1)]),_:2},1032,["type"]),s(t(m),null,{default:a(()=>[s(t(d),{size:"small",onClick:T=>L(l)},{default:a(()=>e[22]||(e[22]=[o("编辑资料")])),_:2,__:[22]},1032,["onClick"]),s(t(d),{size:"small",onClick:T=>W(l)},{default:a(()=>e[23]||(e[23]=[o("修改密码")])),_:2,__:[23]},1032,["onClick"]),s(t(d),{size:"small",onClick:T=>X(l)},{default:a(()=>e[24]||(e[24]=[o("余额操作")])),_:2,__:[24]},1032,["onClick"]),s(t(d),{size:"small",type:l.status==="0"?"error":"success",onClick:T=>te(l)},{default:a(()=>[o(w(l.status==="0"?"封禁":"解封"),1)]),_:2},1032,["type","onClick"]),s(t(d),{size:"small",onClick:T=>se(l.uid)},{default:a(()=>e[25]||(e[25]=[o("强制登录")])),_:2,__:[25]},1032,["onClick"]),s(t(d),{size:"small",type:"error",onClick:T=>ae(l)},{default:a(()=>e[26]||(e[26]=[o("删除用户")])),_:2,__:[26]},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),s(t(ve),{page:c.value,"onUpdate:page":e[2]||(e[2]=l=>c.value=l),"page-size":x.value,"item-count":D.value.length,"show-size-picker":"","page-sizes":[8,16,32,64],"onUpdate:pageSize":e[3]||(e[3]=l=>x.value=l)},null,8,["page","page-size","item-count"]),s(t(z),{show:N.value,"onUpdate:show":e[9]||(e[9]=l=>N.value=l)},{default:a(()=>[s(t(Q),{style:{width:"400px"},title:"添加用户"},{footer:a(()=>[s(t(m),{justify:"end"},{default:a(()=>[s(t(d),{onClick:e[8]||(e[8]=l=>N.value=!1)},{default:a(()=>e[27]||(e[27]=[o("取消")])),_:1,__:[27]}),s(t(d),{type:"primary",onClick:H},{default:a(()=>e[28]||(e[28]=[o("确认")])),_:1,__:[28]})]),_:1})]),default:a(()=>[s(t(O),{ref_key:"addForm",ref:q,model:i,rules:J},{default:a(()=>[s(t(y),{label:"用户名",path:"username"},{default:a(()=>[s(t(v),{value:i.username,"onUpdate:value":e[4]||(e[4]=l=>i.username=l)},null,8,["value"])]),_:1}),s(t(y),{label:"密码",path:"password"},{default:a(()=>[s(t(v),{value:i.password,"onUpdate:value":e[5]||(e[5]=l=>i.password=l),type:"password","show-password-on":"mousedown"},null,8,["value"])]),_:1}),s(t(y),{label:"QQ"},{default:a(()=>[s(t(v),{value:i.QQ,"onUpdate:value":e[6]||(e[6]=l=>i.QQ=l)},null,8,["value"])]),_:1}),s(t(y),{label:"邮箱"},{default:a(()=>[s(t(v),{value:i.email,"onUpdate:value":e[7]||(e[7]=l=>i.email=l)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show"]),s(t(z),{show:j.value,"onUpdate:show":e[14]||(e[14]=l=>j.value=l)},{default:a(()=>[s(t(Q),{style:{width:"400px"},title:"编辑资料"},{footer:a(()=>[s(t(m),{justify:"end"},{default:a(()=>[s(t(d),{onClick:e[13]||(e[13]=l=>j.value=!1)},{default:a(()=>e[29]||(e[29]=[o("取消")])),_:1,__:[29]}),s(t(d),{type:"primary",onClick:R},{default:a(()=>e[30]||(e[30]=[o("确认")])),_:1,__:[30]})]),_:1})]),default:a(()=>[s(t(O),{ref_key:"editForm",ref:B,model:r,rules:J},{default:a(()=>[s(t(y),{label:"用户名",path:"username"},{default:a(()=>[s(t(v),{value:r.username,"onUpdate:value":e[10]||(e[10]=l=>r.username=l)},null,8,["value"])]),_:1}),s(t(y),{label:"QQ"},{default:a(()=>[s(t(v),{value:r.QQ,"onUpdate:value":e[11]||(e[11]=l=>r.QQ=l)},null,8,["value"])]),_:1}),s(t(y),{label:"邮箱"},{default:a(()=>[s(t(v),{value:r.email,"onUpdate:value":e[12]||(e[12]=l=>r.email=l)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show"]),s(t(z),{show:S.value,"onUpdate:show":e[17]||(e[17]=l=>S.value=l)},{default:a(()=>[s(t(Q),{style:{width:"400px"},title:"修改密码"},{footer:a(()=>[s(t(m),{justify:"end"},{default:a(()=>[s(t(d),{onClick:e[16]||(e[16]=l=>S.value=!1)},{default:a(()=>e[31]||(e[31]=[o("取消")])),_:1,__:[31]}),s(t(d),{type:"primary",onClick:Z},{default:a(()=>e[32]||(e[32]=[o("确认")])),_:1,__:[32]})]),_:1})]),default:a(()=>[s(t(O),{ref_key:"pwdForm",ref:E,model:k,rules:V},{default:a(()=>[s(t(y),{label:"新密码",path:"password"},{default:a(()=>[s(t(v),{value:k.password,"onUpdate:value":e[15]||(e[15]=l=>k.password=l),type:"password","show-password-on":"mousedown"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show"]),s(t(z),{show:U.value,"onUpdate:show":e[20]||(e[20]=l=>U.value=l)},{default:a(()=>[s(t(Q),{style:{width:"400px"},title:"余额操作"},{footer:a(()=>[s(t(m),{justify:"end"},{default:a(()=>[s(t(d),{onClick:e[19]||(e[19]=l=>U.value=!1)},{default:a(()=>e[33]||(e[33]=[o("取消")])),_:1,__:[33]}),s(t(d),{type:"primary",onClick:ee},{default:a(()=>e[34]||(e[34]=[o("确认")])),_:1,__:[34]})]),_:1})]),default:a(()=>[s(t(O),{ref_key:"yuanForm",ref:I,model:C,rules:K},{default:a(()=>[s(t(y),{label:"余额",path:"yuan"},{default:a(()=>[s(t(ye),{value:C.yuan,"onUpdate:value":e[18]||(e[18]=l=>C.yuan=l),min:0},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show"])]),_:1})]),_:1})}}};export{be as default};
