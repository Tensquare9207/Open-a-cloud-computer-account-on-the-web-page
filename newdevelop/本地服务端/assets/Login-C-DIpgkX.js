import{u as b,l as T,p as C,r as v,f as l,g as i,o as d,w as t,h as s,m as x,i as m,n as j}from"./index-C5I1O8sb.js";const K={__name:"Login",setup(I){b();const r=T(),{proxy:N}=C(),a=v({user:"",pwd:"",captchaToken:"",captchaId:""}),c=v(!1),h=()=>new Promise((n,e)=>{if(window.ltcaptcha){n();return}const o=document.createElement("script");o.src="http://api.2b2t.ren/files/captcha/captcha.js",o.onload=n,o.onerror=e,document.head.appendChild(o)}),w=async()=>{try{await h(),window.ltcaptcha(1,(n,e)=>{n&&e&&(a.value.captchaToken=n,a.value.captchaId=e)})}catch{r.error("验证加载失败")}},_=async()=>{if(!a.value.captchaToken){r.warning("请先完成人机验证");return}c.value=!0;try{const e=await(await fetch(`${window.server.url}/php/admin/login.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:a.value.user,password:a.value.pwd,token:a.value.captchaToken,id:a.value.captchaId})})).json();e.success?(j.set("admin_token",e.uid),window.location.href="/admin/index"):(r.error(e.message),a.value.captchaToken="")}catch{r.error("网络错误")}finally{c.value=!1}};return(n,e)=>{const o=l("n-input"),p=l("n-form-item"),f=l("n-button"),y=l("n-tag"),k=l("n-form"),g=l("n-card");return d(),i(g,{title:"管理员登录",style:{"max-width":"400px",margin:"0 auto"}},{default:t(()=>[s(k,null,{default:t(()=>[s(p,{label:"账号"},{default:t(()=>[s(o,{value:a.value.user,"onUpdate:value":e[0]||(e[0]=u=>a.value.user=u),placeholder:"请输入账号"},null,8,["value"])]),_:1}),s(p,{label:"密码"},{default:t(()=>[s(o,{type:"password",value:a.value.pwd,"onUpdate:value":e[1]||(e[1]=u=>a.value.pwd=u),placeholder:"请输入密码",onKeyup:x(_,["enter"])},null,8,["value"])]),_:1}),s(p,null,{default:t(()=>[a.value.captchaToken?(d(),i(y,{key:1,type:"success"},{default:t(()=>e[3]||(e[3]=[m("验证完成")])),_:1,__:[3]})):(d(),i(f,{key:0,type:"primary",block:"",onClick:w},{default:t(()=>e[2]||(e[2]=[m(" 人机验证 ")])),_:1,__:[2]}))]),_:1}),s(f,{type:"primary",block:"",onClick:_,loading:c.value,disabled:!a.value.captchaToken},{default:t(()=>e[4]||(e[4]=[m(" 登录 ")])),_:1,__:[4]},8,["loading","disabled"])]),_:1})]),_:1})}}};export{K as default};
